<!DOCTYPE html>
<html>
<head>
    <title>Login | TeamChat</title>
</head>
<body>

<h2>Login</h2>

<p id="error" style="color:red;"></p>

<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">

<button type="button" onclick="login()">Login</button>

<script>
function login() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    fetch("/api/token/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
    })
    .then(res => res.json())
    .then(data => {
        if (!data.access) {
            document.getElementById("error").innerText =
                data.detail || "Invalid credentials";
            return;
        }

        // ✅ Save token
        localStorage.setItem("access_token", data.access);

        // ✅ Fetch tenant list
        return fetch("/api/tenants/my/", {
            headers: {
                "Authorization": "Bearer " + data.access
            }
        });
    })
    .then(res => res.json())
    .then(tenants => {
        if (!tenants.length) {
            alert("No workspace assigned");
            return;
        }

        const tenantId = tenants[0].id;

        // ✅ Correct redirect
        window.location.href = `/collaboration/workspace/${tenantId}/`;
    })
    .catch(err => {
        console.error(err);
        document.getElementById("error").innerText = "Server error";
    });
}
</script>




</body>
</html>
